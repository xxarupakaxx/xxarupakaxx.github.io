---
title: gRPCについて
date: 2021-05-24
author: xxarupakaxx
layout: default
description: gRPCがごちゃごちゃしている
categories:
    - programming
tags:
    - GO
---

# gRPCについて
gRPCにはgRPCとgRPC-webとgRPC-gatewayというものがある
gRPCは単方向の通信とか双方向の通信を可能する
googleがAPI設計の仕方を教えてくれてる
https://cloud.google.com/apis/design
## grpc-web
けども現在gRPC-webは単方向のものと、サーバーストリーミングしか対応していない
gRPC-webはブラウザを挟むで通信を行えるもので、クライアントのjs,tsなどをgRPCで書くことができるつまりクライアントじみたコードがgRPCで書ける
gRPC通信をWebでも使うことができる
同じprotoファイルを共有しているためクライアントとサーバーとの連携が取れる。
スキーマファーストであること
gRPCをクライアントとサーバーで一貫して書ける
だけど既存のプロジェクトをgRPCに書き換えるのは困難手間がかかる
grpc-webでブラウザを使うのにはenvoyというプロキシを挟む必要がある
サーバーだけ実装されているのならgrpc-webは使わないでenvoyやgrpc-gatewayでプロキシを挟んだ方がいい
grpc-webにはmode = grpcwebtext, mode = grpcbinary の二種類のモードがある(grpcのテキストベースで送信するかバイナリで送信するかのどちらか)
パフォーマンス的にはバイナリで送ったほうが良い
フロントの書き換えが大きいことがきつい
新規プロジェクトで用いるなら便利

## grpc-gateway
クライアントから送られてきたJsonベースのリクエストをgRPCに変換してくれるプロキシ
クライアントの書き換えはほぼ不必要でサーバー側がgRPCに対応していれば良い
Json形式を受け取るので解析に時間がかかりgrpc-webと比べたらパフォーマンスは落ちる
grpc-webにはないが、grpc-gatewayにはopenapiのswaggerを作成できるような機能が存在する
https://grpc.io/blog/coreos/
## envoy
gRPCはgRPCにJsonはgRPCに変換してくれるようなプロキシ
gRPCリクエストの負荷分散もできる。